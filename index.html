<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idea Spark</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen flex flex-col p-4">

    <header class="text-center mb-6 relative">
        <h1 class="text-4xl font-bold">Idea Spark âœ¨</h1>
        <p class="mt-2" style="color: var(--text-secondary);">Your personal AI brainstorming partner</p>
    </header>

    <div class="w-full max-w-4xl mx-auto flex-grow">

        <nav class="w-full max-w-lg mx-auto glass-card rounded-full p-2 mb-6">
            <div class="flex justify-around">
                <button id="generatorTab" class="tab active flex-1 text-center font-semibold py-2 px-4 rounded-full transition">Generator</button>
                <button id="savedTab" class="tab flex-1 text-center font-semibold py-2 px-4 rounded-full transition">Saved</button>
                <button id="themesTab" class="tab flex-1 text-center font-semibold py-2 px-4 rounded-full transition">Themes</button>
                <button id="storeTab" class="tab flex-1 text-center font-semibold py-2 px-4 rounded-full transition">Store</button>
            </div>
        </nav>

        <div id="generatorView" class="w-full max-w-md mx-auto">
            <div class="glass-card rounded-2xl shadow-2xl p-6 md:p-8">
                <div class="mb-4">
                    <label for="topic" class="block text-sm font-medium" style="color: var(--text-secondary);">What topic do you need ideas for?</label>
                    <input type="text" id="topic" class="w-full mt-1 border rounded-lg py-3 px-4 focus:outline-none themed-input" placeholder="e.g., 'podcast names'">
                </div>
                <button id="generateBtn" class="w-full font-bold py-3 px-4 rounded-lg transition-all shadow-lg transform hover:scale-105" style="background-color: var(--button-primary-bg); color: var(--button-primary-text);">
                    Generate Ideas
                </button>
                <div id="results-container" class="mt-6">
                    <h2 class="text-xl font-semibold mb-3">Your Ideas:</h2>
                    <div id="loader" class="hidden text-center">
                        <svg class="animate-spin h-8 w-8 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>
                    <div id="results" class="space-y-3"></div>
                    <p id="error-message" class="hidden text-red-400 text-center"></p>
                </div>
            </div>
        </div>

        <div id="savedView" class="hidden">
             <div class="glass-card rounded-2xl shadow-2xl p-6 md:p-8 flex flex-col md:flex-row gap-6">
                <aside class="w-full md:w-1/3 border-b md:border-b-0 md:border-r pb-6 md:pb-0 md:pr-6" style="border-color: var(--glass-border);">
                    <div class="flex gap-2 mb-4">
                        <button id="newFolderBtn" class="flex-1 secondary-btn text-sm font-semibold py-2 px-3 rounded-lg transition">New Folder</button>
                        <button id="selectModeBtn" class="flex-1 secondary-btn text-sm font-semibold py-2 px-3 rounded-lg transition">Select</button>
                    </div>
                    <div id="folder-list" class="space-y-2"></div>
                </aside>

                <main class="w-full md:w-2/3 relative">
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="searchInput" class="flex-grow w-full border rounded-full py-1 px-3 focus:outline-none themed-input" placeholder="Search ideas...">
                    </div>
                    <div id="saved-ideas-list" class="space-y-4 h-[60vh] overflow-y-auto pr-2"></div>
                    <div id="bulkActionBar" class="hidden absolute bottom-0 left-0 right-0 glass-card p-2 rounded-full flex items-center justify-between">
                        <span id="selectionCount" class="text-sm font-semibold px-4">0 items selected</span>
                        <div class="flex gap-2">
                            <button id="bulkMoveBtn" class="bg-indigo-500 hover:bg-indigo-600 font-semibold py-1 px-3 rounded-full transition-colors">Move</button>
                            <button id="bulkDeleteBtn" class="bg-red-500 hover:bg-red-600 font-semibold py-1 px-3 rounded-full transition-colors">Delete</button>
                        </div>
                    </div>
                </main>
             </div>
        </div>

        <div id="themesView" class="hidden"></div>
        <div id="storeView" class="hidden"></div>
    </div>

    <div id="chatModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50"></div>
    <div id="moveFolderModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="glass-card rounded-2xl p-6 max-w-sm w-full">
            <h3 class="font-bold text-lg mb-4">Move to Folder</h3>
            <select id="moveFolderSelect" class="w-full themed-input border rounded-lg p-2 mb-4"></select>
            <div class="flex justify-end gap-2">
                <button id="cancelMoveBtn" class="secondary-btn font-semibold py-1 px-4 rounded-full">Cancel</button>
                <button id="confirmMoveBtn" class="bg-indigo-500 font-semibold py-1 px-4 rounded-full">Move</button>
            </div>
        </div>
    </div>
    <div id="folderColorModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50"></div>
    <div id="newFolderModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="glass-card rounded-2xl p-6 max-w-sm w-full">
            <h3 class="font-bold text-lg mb-4">Create New Folder</h3>
            <input type="text" id="newFolderName" class="w-full themed-input border rounded-lg p-2 mb-4" placeholder="Folder name...">
            <div class="flex justify-end gap-2">
                <button id="cancelNewFolderBtn" class="secondary-btn font-semibold py-1 px-4 rounded-full">Cancel</button>
                <button id="confirmNewFolderBtn" class="bg-indigo-500 font-semibold py-1 px-4 rounded-full">Create</button>
            </div>
        </div>
    </div>

    <script src="script-part1.js"></script>
    <script src="script-part2.js"></script>
</body>
</html>
:root {
    --bg-gradient-start: #667eea;
    --bg-gradient-end: #764ba2;
    --text-main: white;
    --text-secondary: #e0e7ff;
    --glass-bg: rgba(255, 255, 255, 0.1);
    --glass-border: rgba(255, 255, 255, 0.2);
    --input-bg: rgba(255, 255, 255, 0.1);
    --tab-active-bg: rgba(255, 255, 255, 0.2);
    --button-primary-bg: white;
    --button-primary-text: #5b21b6;
    --button-secondary-bg: rgba(255, 255, 255, 0.2);
    --button-secondary-hover-bg: rgba(255, 255, 255, 0.3);
    --favorite-color: #facc15; /* yellow-400 */
    --font-main: 'Inter', sans-serif;
}

[data-theme="light"] {
    --bg-gradient-start: #f3f4f6;
    --bg-gradient-end: #d1d5db;
    --text-main: #1f2937;
    --text-secondary: #4b5563;
    --glass-bg: rgba(255, 255, 255, 0.8);
    --glass-border: rgba(209, 213, 219, 1);
    --input-bg: rgba(255, 255, 255, 1);
    --tab-active-bg: rgba(0, 0, 0, 0.1);
    --button-primary-bg: #4f46e5;
    --button-primary-text: white;
    --button-secondary-bg: rgba(0, 0, 0, 0.05);
    --button-secondary-hover-bg: rgba(0, 0, 0, 0.1);
    --favorite-color: #ca8a04; /* yellow-600 */
}

[data-theme="dark"] {
    --bg-gradient-start: #1f2937;
    --bg-gradient-end: #111827;
    --text-main: #f9fafb;
    --text-secondary: #9ca3af;
    --glass-bg: rgba(55, 65, 81, 0.5);
    --glass-border: rgba(75, 85, 99, 0.6);
    --input-bg: rgba(255, 255, 255, 0.1);
    --tab-active-bg: rgba(75, 85, 99, 1);
    --button-primary-bg: #374151;
    --button-primary-text: white;
    --button-secondary-bg: rgba(255, 255, 255, 0.1);
    --button-secondary-hover-bg: rgba(255, 255, 255, 0.2);
    --favorite-color: #facc15;
}

[data-theme="hacker"] {
    --bg-gradient-start: #000000;
    --bg-gradient-end: #0D0D0D;
    --text-main: #00FF00;
    --text-secondary: #00B300;
    --glass-bg: rgba(0, 255, 0, 0.05);
    --glass-border: rgba(0, 255, 0, 0.1);
    --input-bg: rgba(0, 255, 0, 0.1);
    --tab-active-bg: rgba(0, 255, 0, 0.2);
    --button-primary-bg: #00FF00;
    --button-primary-text: #000000;
    --button-secondary-bg: rgba(0, 255, 0, 0.1);
    --button-secondary-hover-bg: rgba(0, 255, 0, 0.2);
    --favorite-color: #00FF00;
    --font-main: 'Inconsolata', monospace;
}

body {
    font-family: var(--font-main);
    background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
    color: var(--text-main);
    transition: background 0.3s, color 0.3s;
}
.glass-card {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
}
.themed-input {
    background-color: var(--input-bg);
    border-color: var(--glass-border);
    color: var(--text-main);
}
.themed-input::placeholder {
    color: var(--text-secondary);
    opacity: 0.7;
}

.tab.active { background-color: var(--tab-active-bg); }
textarea { resize: none; overflow-y: hidden; }
.folder-item.active { background-color: var(--tab-active-bg); }
.secondary-btn {
    background-color: var(--button-secondary-bg);
    color: var(--text-main);
}
.secondary-btn:hover {
    background-color: var(--button-secondary-hover-bg);
}
.selected-card {
    border-color: var(--favorite-color) !important;
    transform: scale(1.02);
}
// --- DOM Elements ---
const uiElements = {
    body: document.body, topicInput: document.getElementById('topic'), generateBtn: document.getElementById('generateBtn'),
    resultsDiv: document.getElementById('results'), loader: document.getElementById('loader'), errorMessage: document.getElementById('error-message'),
    savedIdeasList: document.getElementById('saved-ideas-list'),
    generatorView: document.getElementById('generatorView'), savedView: document.getElementById('savedView'), storeView: document.getElementById('storeView'), themesView: document.getElementById('themesView'),
    generatorTab: document.getElementById('generatorTab'), savedTab: document.getElementById('savedTab'), storeTab: document.getElementById('storeTab'), themesTab: document.getElementById('themesTab'),
    chatModal: document.getElementById('chatModal'),
    newFolderBtn: document.getElementById('newFolderBtn'), searchInput: document.getElementById('searchInput'),
    folderList: document.getElementById('folder-list'),
    selectModeBtn: document.getElementById('selectModeBtn'), bulkActionBar: document.getElementById('bulkActionBar'),
    selectionCount: document.getElementById('selectionCount'), bulkMoveBtn: document.getElementById('bulkMoveBtn'), bulkDeleteBtn: document.getElementById('bulkDeleteBtn'),
    moveFolderModal: document.getElementById('moveFolderModal'), moveFolderSelect: document.getElementById('moveFolderSelect'),
    cancelMoveBtn: document.getElementById('cancelMoveBtn'), confirmMoveBtn: document.getElementById('confirmMoveBtn'),
    folderColorModal: document.getElementById('folderColorModal'),
    newFolderModal: document.getElementById('newFolderModal'), newFolderName: document.getElementById('newFolderName'),
    cancelNewFolderBtn: document.getElementById('cancelNewFolderBtn'), confirmNewFolderBtn: document.getElementById('confirmNewFolderBtn')
};

// --- App State & Config ---
let ideasData = { folders: [], uncategorized: [], favoriteIDs: [], ownedThemes: ['classic', 'light', 'dark'], trash: [] };
let activeFolder = 'all';
let generatedIdeas = [];
let editing = { ideaId: null };
let moving = { ideaId: null };
let selectMode = false;
let selectedItems = new Set();
const FOLDER_COLORS = {
    default: 'border-white/20', red: 'border-red-500', blue: 'border-blue-500',
    green: 'border-green-500', yellow: 'border-yellow-500', purple: 'border-purple-500', pink: 'border-pink-500',
};

// --- Event Listeners ---
function addEventListeners() {
    window.addEventListener('load', () => {
        loadIdeasData();
        const savedTheme = localStorage.getItem('ideaSparkTheme') || 'classic';
        setTheme(savedTheme);
    });
    uiElements.generatorTab.addEventListener('click', () => switchView('generator'));
    uiElements.savedTab.addEventListener('click', () => switchView('saved'));
    uiElements.storeTab.addEventListener('click', () => switchView('store'));
    uiElements.themesTab.addEventListener('click', () => switchView('themes'));
    uiElements.generateBtn.addEventListener('click', handleGeneration);
    uiElements.newFolderBtn.addEventListener('click', () => uiElements.newFolderModal.classList.remove('hidden'));
    uiElements.cancelNewFolderBtn.addEventListener('click', () => uiElements.newFolderModal.classList.add('hidden'));
    uiElements.confirmNewFolderBtn.addEventListener('click', handleConfirmNewFolder);
    uiElements.searchInput.addEventListener('input', renderSavedIdeas);
    uiElements.cancelMoveBtn.addEventListener('click', () => uiElements.moveFolderModal.classList.add('hidden'));
    uiElements.confirmMoveBtn.addEventListener('click', handleConfirmMove);
    uiElements.selectModeBtn.addEventListener('click', toggleSelectMode);
    uiElements.bulkMoveBtn.addEventListener('click', handleBulkMove);
    uiElements.bulkDeleteBtn.addEventListener('click', handleBulkDelete);
}

// --- Core Functions: View Switching, Data Persistence, Theming ---
function switchView(viewName) {
    editing.ideaId = null;
    if (selectMode) { toggleSelectMode(); } // Exit select mode when switching views

    const views = ['generator', 'saved', 'store', 'themes'];
    views.forEach(v => {
        const viewElement = uiElements[`${v}View`];
        if (viewElement) viewElement.classList.toggle('hidden', v !== viewName);
        uiElements[`${v}Tab`].classList.toggle('active', v === viewName);
    });

    if (viewName === 'saved') {
        activeFolder = 'all';
        renderFolderList();
        renderSavedIdeas();
    }
}

async function handleGeneration() {
    // This function remains largely the same
    // (For brevity, its content is omitted here but should be included from your original file)
}

function loadIdeasData() {
    try {
        const data = localStorage.getItem('ideaSparkData_v5');
        if (data) {
            const parsedData = JSON.parse(data);
            ideasData.folders = parsedData.folders?.map(f => ({ ...f, isCollapsed: f.isCollapsed ?? false, color: f.color ?? 'default' })) || [];
            ideasData.uncategorized = parsedData.uncategorized || [];
            ideasData.favoriteIDs = parsedData.favoriteIDs || [];
            ideasData.ownedThemes = parsedData.ownedThemes || ['classic', 'light', 'dark'];
            ideasData.trash = parsedData.trash || [];
        } else {
            ideasData = { folders: [], uncategorized: [], favoriteIDs: [], ownedThemes: ['classic', 'light', 'dark'], trash: [] };
        }
    } catch (e) {
        console.error("Failed to load data, resetting.", e);
        ideasData = { folders: [], uncategorized: [], favoriteIDs: [], ownedThemes: ['classic', 'light', 'dark'], trash: [] };
    }
}

function saveData() {
    localStorage.setItem('ideaSparkData_v5', JSON.stringify(ideasData));
    if (!uiElements.savedView.classList.contains('hidden')) {
        renderFolderList();
        renderSavedIdeas();
    }
    if (!uiElements.generatorView.classList.contains('hidden')) {
        // This function is in part 2, but is called here
        displayGeneratedIdeas();
    }
}

function setTheme(themeName) {
    if (!ideasData.ownedThemes.includes(themeName)) return;
    uiElements.body.dataset.theme = themeName;
    localStorage.setItem('ideaSparkTheme', themeName);
}

// Initialize the app
addEventListeners();
// --- Idea & Folder Actions ---

function handleConfirmNewFolder() {
    const folderName = uiElements.newFolderName.value.trim();
    if (folderName && !ideasData.folders.some(f => f.name === folderName)) {
        ideasData.folders.push({ name: folderName, ideas: [], isCollapsed: false, color: 'default' });
        saveData();
        uiElements.newFolderName.value = '';
        uiElements.newFolderModal.classList.add('hidden');
    } else if (folderName) {
        alert("A folder with that name already exists.");
    }
}

function openMoveModal(ideaId) {
    moving.ideaId = ideaId; // Used for single moves
    uiElements.moveFolderSelect.innerHTML = `<option value="uncategorized">Uncategorized</option>`;
    ideasData.folders.forEach((folder, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = folder.name;
        uiElements.moveFolderSelect.appendChild(option);
    });
    uiElements.moveFolderModal.classList.remove('hidden');
}

function handleConfirmMove() {
    const targetFolderValue = uiElements.moveFolderSelect.value;
    const moveList = selectMode ? Array.from(selectedItems) : [moving.ideaId];
    
    moveList.forEach(idToMove => {
        if (!idToMove) return;
        const ideaToMove = findAndRemoveIdea(idToMove);
        if (!ideaToMove) return;

        if (targetFolderValue === 'uncategorized') {
            ideasData.uncategorized.unshift(ideaToMove);
        } else {
            ideasData.folders[targetFolderValue].ideas.unshift(ideaToMove);
        }
    });

    if (selectMode) toggleSelectMode();
    saveData();
    uiElements.moveFolderModal.classList.add('hidden');
}

function deleteIdea(ideaId) {
    const idea = findAndRemoveIdea(ideaId);
    if (idea) {
        ideasData.trash.unshift(idea);
        saveData();
    }
}

function findAndRemoveIdea(id) {
    // (Content omitted for brevity, include from original file)
}

function findIdeaLocation(id) {
    // (Content omitted for brevity, include from original file)
}


// --- Select Mode & Bulk Actions ---

function toggleSelectMode() {
    selectMode = !selectMode;
    selectedItems.clear();
    uiElements.selectModeBtn.textContent = selectMode ? 'Cancel' : 'Select';
    uiElements.selectModeBtn.classList.toggle('active', selectMode);
    uiElements.bulkActionBar.classList.toggle('hidden', !selectMode);
    if (!selectMode) {
        uiElements.selectionCount.textContent = '0 items selected';
    }
    renderSavedIdeas();
}

function handleItemSelection(ideaId) {
    if (selectedItems.has(ideaId)) {
        selectedItems.delete(ideaId);
    } else {
        selectedItems.add(ideaId);
    }
    uiElements.selectionCount.textContent = `${selectedItems.size} items selected`;
    // Visually update just the one card instead of re-rendering everything
    const card = uiElements.savedIdeasList.querySelector(`[data-id='${ideaId}']`);
    if (card) {
        card.classList.toggle('selected-card', selectedItems.has(ideaId));
    }
}

function handleBulkDelete() {
    if (selectedItems.size === 0) return;
    if (confirm(`Are you sure you want to delete ${selectedItems.size} ideas?`)) {
        selectedItems.forEach(id => deleteIdea(id)); // Uses the single deleteIdea function
        toggleSelectMode(); // This calls saveData via render functions
    }
}

function handleBulkMove() {
    if (selectedItems.size === 0) return;
    openMoveModal(null); // Open modal for bulk action
}


// --- Rendering Functions ---

function createIdeaCard(ideaObj, type) {
    const ideaElement = document.createElement('div');
    ideaElement.className = 'glass-card p-4 rounded-lg flex flex-col gap-3 transition-transform duration-200';
    ideaElement.dataset.id = ideaObj.id;

    if (selectMode && type === 'saved') {
        ideaElement.classList.add('cursor-pointer');
        if (selectedItems.has(ideaObj.id)) {
            ideaElement.classList.add('selected-card');
        }
        ideaElement.onclick = () => handleItemSelection(ideaObj.id);
        const mainContent = document.createElement('div');
        mainContent.textContent = ideaObj.originalIdea;
        ideaElement.appendChild(mainContent);
    } else {
        // Existing logic for creating card content and buttons
        // (Content omitted for brevity, include from original file)
        // Ensure you remove the .onclick handler for the element itself
        ideaElement.onclick = null;
    }
    return ideaElement;
}


function renderFolderList() {
    // (Content omitted for brevity, include from original file)
}

function renderSavedIdeas() {
    uiElements.savedIdeasList.innerHTML = '';
    const searchTerm = uiElements.searchInput.value.toLowerCase();
    let ideasToRender = [];

    if (activeFolder === 'all') {
        ideasToRender = [...ideasData.folders.flatMap(f => f.ideas), ...ideasData.uncategorized];
    } else if (activeFolder === 'favorites') {
        const allIdeas = [...ideasData.folders.flatMap(f => f.ideas), ...ideasData.uncategorized];
        ideasToRender = allIdeas.filter(idea => ideasData.favoriteIDs.includes(idea.id));
    } else if (activeFolder === 'trash') {
        ideasToRender = ideasData.trash;
    } else if (typeof activeFolder === 'number' && ideasData.folders[activeFolder]) {
        ideasToRender = ideasData.folders[activeFolder].ideas;
    }
    
    const filteredList = ideasToRender.filter(idea => idea.originalIdea.toLowerCase().includes(searchTerm));

    if (filteredList.length > 0) {
        filteredList.forEach(ideaObj => {
           const type = activeFolder === 'trash' ? 'trash' : 'saved';
           uiElements.savedIdeasList.appendChild(createIdeaCard(ideaObj, type));
        });
   } else {
        uiElements.savedIdeasList.innerHTML = `<p class="text-center" style="color:var(--text-secondary)">No ideas here.</p>`;
   }
}

function displayGeneratedIdeas() {
    // (Content omitted for brevity, include from original file)
}
